# ESP32 Checking程序分解

## 一、控制中心分解

![image-20250314160059557](./assets/image-20250314160059557.png)

控制中心的所有项，都存储在$./src-tauri/config/config.toml$文件中,此文件以及其他文件的的全局变量在程序启动时通过$lib.rs$中下存到全局变量

```rust
.setup(|app| {
            // 获取 config 目录路径
            let config_dir = app
                .path()
                .resolve("config", BaseDirectory::Resource)
                .expect("Failed to resolve config directory");

            // 将 config 目录路径存储到全局变量
            *CONFIG_DIR.lock().unwrap() = Some(config_dir.to_string_lossy().to_string());
            let config_path = app
                .path()
                .resolve("config/config.toml", BaseDirectory::Resource)
                .expect("Failed to resolve config.toml");

            // 获取 board.db 文件路径
            let board_path = app
                .path()
                .resolve("config/board.db", BaseDirectory::Resource)
                .expect("Failed to resolve board.db");

            // 将文件路径存储到全局变量
            *CONFIG_PATH.lock().unwrap() = Some(config_path.to_string_lossy().to_string());
            *BOARD_PATH.lock().unwrap() = Some(board_path.to_string_lossy().to_string());

            println!("Config path: {:?}", config_path);
            println!("Board path: {:?}", board_path);
            println!("Config directory: {:?}", config_dir);
            Ok(())
        })
```

随即可以在程序中可以通过这三个函数获取到路径，

```rust
// 提供一个函数供其他程序获取 config 目录路径
pub fn get_config_dir() -> Option<String> {
    CONFIG_DIR.lock().unwrap().clone()
}

// 提供函数供其他程序获取文件路径
pub fn get_config_path() -> Option<String> {
    CONFIG_PATH.lock().unwrap().clone()
}

pub fn get_board_path() -> Option<String> {
    BOARD_PATH.lock().unwrap().clone()
}
```

c